<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>BinGo&#39;s Blog on BinGo&#39;s Blog</title>
    <link>https://aka-bingo.github.io/</link>
    <description>Recent content in BinGo&#39;s Blog on BinGo&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 03 Sep 2019 20:49:19 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Golang Channel å­¦ä¹ ç¬”è®°</title>
      <link>https://aka-bingo.github.io/2019/09/golang-channel-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</link>
      <pubDate>Tue, 03 Sep 2019 20:49:19 +0800</pubDate>
      
      <guid>https://aka-bingo.github.io/2019/09/golang-channel-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</guid>
      <description>

&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;

&lt;p&gt;Channel æ˜¯ Go è¯­è¨€ä¸­å¹¶å‘æ¨¡å‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ goroutine ä¹‹é—´è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œchannel å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ— ç¼“å†² channelï¼šåœ¨æ— ç¼“å†² channel ä¸­ï¼Œæ•°æ®çš„å‘é€å’Œè¯»å–æ“ä½œéœ€è¦åŒæ—¶è¿›è¡Œï¼Œå½“åªæœ‰ä¸€ä¸ª goroutine A è¿›è¡Œæ•°æ®çš„è¯»å–ï¼ˆå†™å…¥ï¼‰æ—¶ï¼Œéœ€è¦ç­‰å¾…å¦ä¸€ä¸ª goroutine B é€šè¿‡è¿™ä¸ª channel è¿›è¡Œæ•°æ®å†™å…¥ï¼ˆè¯»å–ï¼‰ã€‚åœ¨æ­¤ä¹‹å‰ goroutine A ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° goroutine Bæ¥æ‹¯æ•‘å®ƒã€‚&lt;/li&gt;
&lt;li&gt;æœ‰ç¼“å†² channelï¼šåœ¨æœ‰ç¼“å†² channel ä¸­ï¼Œä¼šè‡ªå¸¦ä¸€ä¸ªç¼“å†²å¾ªç¯é˜Ÿåˆ—ã€‚å½“ goroutine è¿›è¡Œæ•°æ®è¯»å–æ—¶ï¼Œå¦‚æœç¼“å†²é˜Ÿåˆ—ä¸­æœ‰æ•°æ®ä¾¿ç›´æ¥è¯»å–ï¼Œå¦‚æœæ²¡æœ‰ä¾¿é˜»å¡ç­‰å¾…å…¶ä»– goroutine å†™å…¥æ•°æ®ã€‚å½“ goroutine è¿›è¡Œæ•°æ®å†™å…¥æ—¶ï¼Œå¦‚æœç¼“å†²é˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™ç›´æ¥å†™å…¥æ•°æ®åç¦»å¼€ã€‚å¦‚æœç¼“å†²é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™éœ€è¦ç­‰å¾…å…¶ä»– goroutine æ¥æ¶ˆè´¹ç¼“å†²é˜Ÿåˆ—ï¼Œæ‰èƒ½ç»§ç»­å†™å…¥ï¼Œåœ¨æ­¤ä¹‹å‰åªèƒ½ä¸€ç›´é˜»å¡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;channel-æ•°æ®ç»“æ„&#34;&gt;Channel æ•°æ®ç»“æ„&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Go è¯­è¨€ä¸­ Channel çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;# go1.13:src/runtime/chan.go:32 
type hchan struct {
	qcount   uint           // å½“å‰channelä¸­å…ƒç´ çš„ä¸ªæ•°
	dataqsiz uint           // å¾ªç¯é˜Ÿåˆ—çš„é•¿åº¦
	buf      unsafe.Pointer // æŒ‡é’ˆ, æŒ‡å‘ä¸€ä¸ªé•¿åº¦ä¸ºdataqsizeçš„æ•°ç»„, å³ç¼“å†²é˜Ÿåˆ—
	elemsize uint16 // channelå¯ä»¥æ¥æ”¶çš„å…ƒç´ å¤§å°(å•ä¸ª)
	closed   uint32	// channelçš„å…³é—­çŠ¶æ€
	elemtype *_type // channelå¯ä»¥æ¥æ”¶çš„å…ƒç´ ç±»å‹
	sendx    uint   // æ ‡ç¤ºå½“å‰å¯å‘é€å…ƒç´ çš„ä½ç½®(æ•°ç»„ä¸‹æ ‡)
	recvx    uint   // æ ‡ç¤ºå½“å‰å¯æ¥æ”¶å…ƒç´ çš„ä½ç½®(æ•°ç»„ä¸‹æ ‡)
	recvq    waitq  // é˜»å¡çš„æ¥æ”¶ goroutine é˜Ÿåˆ—
	sendq    waitq  // é˜»å¡çš„å‘é€ goroutine é˜Ÿåˆ—

	// lock protects all fields in hchan, as well as several
	// fields in sudogs blocked on this channel.
	//
	// Do not change another G&#39;s status while holding this lock
	// (in particular, do not ready a G), as this can deadlock
	// with stack shrinking.
	lock mutex	// åŸå­é”ğŸ”’
}

# go1.13.7:src/runtime/chan.go:53
type waitq struct {
	first *sudog	//æŒ‡å‘é˜Ÿåˆ—å¤´éƒ¨çš„ goroutine æŒ‡é’ˆ
	last  *sudog	//æŒ‡å‘é˜Ÿåˆ—å°¾éƒ¨çš„ goroutine æŒ‡é’ˆ
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;channel åœ¨ Go è¯­è¨€ä¸­æ˜¯ä»¥  &lt;code&gt;hchan&lt;/code&gt; ç»“æ„ä½“å­˜åœ¨çš„ï¼Œç»“æ„ä½“ä¸­çš„å­—æ®µå¦‚æ³¨é‡Šæ‰€ç¤ºã€‚å…¶ä¸­  &lt;code&gt;sudog&lt;/code&gt; å¯ä»¥è®¤ä¸ºæ˜¯ goroutine çš„é¢å¤–å°è£…ã€‚&lt;/p&gt;

&lt;h2 id=&#34;channel-åˆ›å»º&#34;&gt;Channel åˆ›å»º&lt;/h2&gt;

&lt;p&gt;channel çš„åˆ›å»ºæœ€ç»ˆéƒ½ä¼šè°ƒç”¨  &lt;code&gt;makechan()&lt;/code&gt; æ¥å£ï¼Œè¯ä¸å¤šè¯´å…ˆä¸Šæºç ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;# go1.13:src/runtime/chan.go:71
func makechan(t *chantype, size int) *hchan {
	elem := t.elem

	// compiler checks this but be safe.
	if elem.size &amp;gt;= 1&amp;lt;&amp;lt;16 {	// channelå…ƒç´ å¤§å°æ ¡éªŒ, ä¸èƒ½è¶…è¿‡64KB
		throw(&amp;quot;makechan: invalid channel element type&amp;quot;)
	}
	if hchanSize%maxAlign != 0 || elem.align &amp;gt; maxAlign { // å†…å­˜å¯¹é½é™åˆ¶æ£€æŸ¥
		throw(&amp;quot;makechan: bad alignment&amp;quot;)
	}

	mem, overflow := math.MulUintptr(elem.size, uintptr(size)) //ç”³è¯·å†…å­˜çš„é¢„æ£€æŸ¥
	if overflow || mem &amp;gt; maxAlloc-hchanSize || size &amp;lt; 0 {
		panic(plainError(&amp;quot;makechan: size out of range&amp;quot;))
	}

	// Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers.
	// buf points into the same allocation, elemtype is persistent.
	// SudoG&#39;s are referenced from their owning thread so they can&#39;t be collected.
	// TODO(dvyukov,rlh): Rethink when collector can move allocated objects.
	var c *hchan
	switch {
	case mem == 0:
		// Queue or element size is zero.
		c = (*hchan)(mallocgc(hchanSize, nil, true))
		// Race detector uses this location for synchronization.
		c.buf = c.raceaddr()
	case elem.ptrdata == 0:
		// Elements do not contain pointers.
		// Allocate hchan and buf in one call.
		c = (*hchan)(mallocgc(hchanSize+mem, nil, true))
		c.buf = add(unsafe.Pointer(c), hchanSize)
	default:
		// Elements contain pointers.
		c = new(hchan)
		c.buf = mallocgc(mem, elem, true)
	}

	c.elemsize = uint16(elem.size)
	c.elemtype = elem
	c.dataqsiz = uint(size)

	if debugChan {
		print(&amp;quot;makechan: chan=&amp;quot;, c, &amp;quot;; elemsize=&amp;quot;, elem.size, &amp;quot;; elemalg=&amp;quot;, elem.alg, &amp;quot;; dataqsiz=&amp;quot;, size, &amp;quot;\n&amp;quot;)
	}
	return c
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¦–å…ˆæ˜¯ä¸€ç³»åˆ—çš„å®‰å…¨æ£€æŸ¥ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ£€æŸ¥ channel å…ƒç´ ç±»å‹çš„å¤§å°ï¼Œä¸èƒ½è¶…è¿‡64KBã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ£€æŸ¥ chennel å…ƒç´ ç»“æ„ä½“æ˜¯å¦å·²ç»å¯¹é½ï¼Œä»¥åŠ channel ä¸­çš„å…ƒç´ å†…å­˜å¯¹é½å€¼ä¸å¾—è¶…è¿‡  maxAlign ï¼ˆåœ¨å½“å‰ç‰ˆæœ¬ä¸­ maxAlign çš„å€¼ä¸º8ï¼‰&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ£€æŸ¥ç¼“å†²é˜Ÿåˆ—çš„å†…å­˜ç”³è¯·æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªåˆ¤æ–­ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç”³è¯·çš„å†…å­˜æ˜¯å¦æº¢å‡º&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ˜¯å¦è¶…è¿‡å…è®¸åˆ›å»ºçš„æœ€å¤§å†…å­˜é™åˆ¶ã€‚è¿™é‡Œéœ€è¦å‡å» channel ç»“æ„æœ¬èº«çš„å†…å­˜å ç”¨ hchanSizeï¼Œè¿™ä¸ªå†…å­˜å ç”¨å¤§å°çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;unsafe.Sizeof(hchan{}) + uintptr(-int(unsafe.Sizeof(hchan{}))&amp;amp;(maxAlign-1))
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å½“ç„¶ï¼Œç”³è¯·çš„å†…å­˜å¤§å°ä¸èƒ½ä¸ºè´Ÿæ•°&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€šè¿‡å®‰å…¨æ£€æŸ¥ä¹‹åï¼Œä¼šå£°æ˜ &lt;code&gt;hchan&lt;/code&gt; æŒ‡é’ˆ cï¼Œæ ¹æ®3ç§ä¸åŒçš„æƒ…å†µå¯¹ c è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ›å»ºçš„æ˜¯æ— ç¼“å†² channel ï¼šå³ç”³è¯·ç¼“å†²é˜Ÿåˆ—çš„å¤§å°ä¸º0ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä¸º c ç”³è¯· hchanSize å¤§å°çš„å†…å­˜ã€‚åŒæ—¶è°ƒç”¨ raceaddr() å¯¹ç¼“å†²é˜Ÿåˆ—æŒ‡é’ˆåœ°å€è¿›è¡Œè¯»å†™æ“ä½œï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢åœ¨è°ƒç”¨ len() æˆ– cap() å‡½æ•°æ—¶è¯»å–å†…å­˜åœ°å€å’Œå…¶ä»–æ“ä½œäº§ç”Ÿèµ„æºç«äº‰ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºçš„æ˜¯æœ‰ç¼“å†² channel ä¸”ç¼“å†²é˜Ÿåˆ—å…ƒç´ ä¸åŒ…å«æŒ‡é’ˆï¼šä¼šä¸º c ç”³è¯·ä¸€æ®µ hchanSize + mem å¤§å°çš„å†…å­˜ï¼Œå¹¶å°†ç¼“å†²é˜Ÿåˆ—æŒ‡é’ˆæŒ‡å‘å†…å­˜åœ°å€åæ®µï¼Œå³åŠ ä¸Š hchanSize çš„åç§»é‡åæŒ‡å‘ä¸€æ®µé•¿åº¦ä¸º mem çš„å†…å­˜åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºçš„æ˜¯æœ‰ç¼“å†² channel ä¸”ç¼“å†²é˜Ÿåˆ—å…ƒç´ åŒ…å«æŒ‡é’ˆï¼šåˆ†åˆ«ä¸º c å’Œç¼“å†²é˜Ÿåˆ— c.buf åˆ†é…å¯¹åº”å¤§å°çš„å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å‰©ä¸‹çš„æ“ä½œä¾¿æ˜¯ä¸€äº›ä¸Šæ–‡æåˆ°çš„å˜é‡åˆå§‹åŒ–å’Œ Debug æ—¥å¿—è¾“å‡ºäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;channel-å‘é€&#34;&gt;Channel å‘é€&lt;/h2&gt;

&lt;p&gt;channel çš„å‘é€é€»è¾‘å®ç°ä¸»è¦æ˜¯åœ¨ &lt;code&gt;src/runtime/chan.go&lt;/code&gt; ä¸­çš„  &lt;code&gt;chansend()&lt;/code&gt; å’Œ &lt;code&gt;send()&lt;/code&gt;ï¼Œç”±äºå®ç°é€»è¾‘æ¯”è¾ƒå†—é•¿ï¼Œæƒ…å†µä¹Ÿæ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸ç›´æ¥ä»£ç éª‘è„¸ï¼Œæˆ‘ä»¬æ ¹æ®ä¸åŒçš„æƒ…å†µå…·ä½“åˆ†æï¼š&lt;/p&gt;

&lt;h3 id=&#34;æ— ç¼“å†²-channel-å‘é€&#34;&gt;æ— ç¼“å†² channel å‘é€&lt;/h3&gt;

&lt;h4 id=&#34;ç›´æ¥å‘é€&#34;&gt;ç›´æ¥å‘é€&lt;/h4&gt;

&lt;p&gt;å‰æ–‡è¯´è¿‡æ— ç¼“å†² channel åœ¨å‘é€æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”æ¥æ”¶çš„ goroutineï¼Œå°±ä¼šå°†å½“å‰çš„å‘é€ goroutine æ”¾å…¥ sendq é˜Ÿåˆ—ï¼Œæ‰€ä»¥å‘é€æ—¶ï¼Œç¬¬ä¸€æ­¥ä¼šå…ˆæ£€æŸ¥ recvq é˜Ÿåˆ—æ˜¯å¦æœ‰æ¥æ”¶ goroutine åœ¨ç­‰å¾…æ¥æ”¶ï¼Œ å¦‚æœå·²ç»æœ‰ç­‰å¾…æ¥æ”¶çš„ goroutineï¼Œä¾¿ç›´æ¥è°ƒç”¨ &lt;code&gt;send()&lt;/code&gt; è¿›è¡Œæ•°æ®å‘é€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:190
if sg := c.recvq.dequeue(); sg != nil {
	// Found a waiting receiver. We pass the value we want to send
	// directly to the receiver, bypassing the channel buffer (if any).
	send(c, sg, ep, func() { unlock(&amp;amp;c.lock) }, 3)
	return true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å‘é€é˜»å¡&#34;&gt;å‘é€é˜»å¡&lt;/h4&gt;

&lt;p&gt;å½“æ¥æ”¶é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œç¨‹åºä¼šæ£€æŸ¥å½“å‰ channel çš„ç¼“å†²é˜Ÿåˆ—æ˜¯å¦å¯ç”¨ï¼ˆå½“ç„¶åœ¨æ— ç¼“å†² channel ä¸­ç­”æ¡ˆæ—¶è‚¯å®šä¸è¡Œçš„ï¼‰ï¼Œäºæ˜¯ä¼šè·å–å½“å‰å‘é€çš„ goroutineï¼Œæ ¹æ®è¿™ä¸ª goroutine å°è£…ä¸€ä¸ªä¸Šæ–‡æåˆ°çš„ &lt;code&gt;sudog&lt;/code&gt; ç»“æ„å¹¶æ”¾å…¥ sendq é˜Ÿåˆ—ä¸­å¹¶å°†å½“å‰çš„ goroutine è®¾ç½®ä¸ºä¼‘çœ çŠ¶æ€ï¼ˆé€šè¿‡è°ƒç”¨ &lt;code&gt;goparkunlock()&lt;/code&gt;ï¼‰ã€‚åŒæ—¶ä¹Ÿä¼šè°ƒç”¨ &lt;code&gt;KeepAlive()&lt;/code&gt; å°†å½“å‰å‘é€çš„æ•°æ®ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰æ•°æ®çš„æŒ‡é’ˆï¼‰æ ‡è®°ä¸º reachable ä»¥é˜²æ­¢æ•°æ®åœ¨å‘é€å‰è¢«é‡Šæ”¾æˆ–ä¿®æ”¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:219
// Block on the channel. Some receiver will complete our operation for us.
gp := getg()
mysg := acquireSudog()
mysg.releasetime = 0
if t0 != 0 {
	mysg.releasetime = -1
}
// No stack splits between assigning elem and enqueuing mysg
// on gp.waiting where copystack can find it.
mysg.elem = ep
mysg.waitlink = nil
mysg.g = gp
mysg.isSelect = false
mysg.c = c
gp.waiting = mysg
gp.param = nil
c.sendq.enqueue(mysg)
goparkunlock(&amp;amp;c.lock, waitReasonChanSend, traceEvGoBlockSend, 3)
// Ensure the value being sent is kept alive until the
// receiver copies it out. The sudog has a pointer to the
// stack object, but sudogs aren&#39;t considered as roots of the
// stack tracer.
KeepAlive(ep)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æœ‰ç¼“å†²-channel-å‘é€&#34;&gt;æœ‰ç¼“å†² channel å‘é€&lt;/h3&gt;

&lt;h4 id=&#34;ç›´æ¥å‘é€-1&#34;&gt;ç›´æ¥å‘é€&lt;/h4&gt;

&lt;p&gt;åŒæ— ç¼“å†² channel ä¸€æ ·ï¼Œå‘é€çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¯¹æ¥æ”¶é˜Ÿåˆ— recvq è¿›è¡Œæ£€æŸ¥ï¼ˆå› ä¸ºæ­¤æ—¶å¦‚æœ recvq é˜Ÿåˆ—æœ‰æ­£åœ¨ç­‰å¾…æ¥æ”¶çš„ goroutineï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„æ•°æ®ä¸€å®šå·²ç»è¢«è¯»å–å®Œäº†ï¼‰ï¼Œå¦‚æœæœ‰æ­£åœ¨ç­‰å¾…æ¥æ”¶çš„ goroutineï¼Œé‚£ä¹ˆè·Ÿä¸Šæ–‡çš„æ— ç¼“å†² channel æ˜¯ä¸€æ ·çš„å¤„ç†ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå¦‚æœ recvq é˜Ÿåˆ—ä¸ºç©ºï¼Œç¨‹åºä¼šç»§ç»­æ£€æŸ¥å½“å‰ç¼“å†²åŒºæ˜¯å¦è¿˜æœ‰ç©ºé—´ï¼Œå¦‚æœè¿˜æœ‰ç©ºé—´ï¼Œä¾¿å°†å‘é€çš„æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œè€Œå½“å‰çš„ goroutine å°±å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œäº†ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:197
if c.qcount &amp;lt; c.dataqsiz {
	// Space is available in the channel buffer. Enqueue the element to send.
	qp := chanbuf(c, c.sendx) //è·å–é˜Ÿåˆ—ä¸‹ä¸€ä¸ªä½ç½®å‘é€æ•°æ®çš„å­˜å‚¨ä½ç½®
	if raceenabled {	//ç«äº‰æ£€æµ‹ï¼Œåœ¨å½“å‰ç‰ˆæœ¬ä¸­ raceenabled é»˜è®¤ä¸º falseï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶åŠ ä¸Š -race æ‰ä¼šæˆä¸º true
		raceacquire(qp)
		racerelease(qp)
	}
	typedmemmove(c.elemtype, qp, ep)	//å°†å‘é€çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒº
	c.sendx++	//ç¼“å†²åŒºçš„å‘é€æŒ‡é’ˆä½ç½®è°ƒæ•´
	if c.sendx == c.dataqsiz { //å¾ªç¯é˜Ÿåˆ—å¸¸è§„æ“ä½œ
		c.sendx = 0
	}
	c.qcount++
	unlock(&amp;amp;c.lock)
	return true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å‘é€é˜»å¡-1&#34;&gt;å‘é€é˜»å¡&lt;/h4&gt;

&lt;p&gt;å¦‚æœç¼“å†²é˜Ÿåˆ—å®¹é‡å·²æ»¡ï¼Œé‚£ä¹ˆå³ä½¿æ˜¯æœ‰ç¼“å†²çš„ channelï¼Œä¹Ÿä¼šå°†å½“å‰å‘é€æ•°æ®çš„ goroutine æŒ‚èµ·ï¼Œå…·ä½“æ“ä½œå’Œæ— ç¼“å†² channel æ˜¯ä¸€è‡´çš„ï¼Œè¿™é‡Œå°±ä¸åšèµ˜è¿°äº†ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹&lt;a href=&#34;#å‘é€é˜»å¡&#34;&gt;æ— ç¼“å†² channel å‘é€æ•°æ®é˜»å¡è¿‡ç¨‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å”¤é†’&#34;&gt;å”¤é†’&lt;/h3&gt;

&lt;p&gt;åœ¨é˜»å¡çŠ¶æ€è¿›è¡Œäº†æ¼«é•¿çš„ç­‰å¾…ä¹‹åï¼Œæœ‰ä¸€å¤©ï¼Œä¸€ä¸ªä»è¿œæ–¹è€Œæ¥è¿›è¡Œæ¥æ”¶æ•°æ®çš„ goroutine ç»ˆäºå‡ºç°ï¼Œè¿™ä¸ªæ—¶å€™ä¼‘çœ çŠ¶æ€çš„å‘é€ goroutine è¢«å”¤é†’ï¼Œè¿›è¡Œæ•°æ®çš„æ”¶å°¾åŠé‡Šæ”¾ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:243
// someone woke us up.
if mysg != gp.waiting {
	throw(&amp;quot;G waiting list is corrupted&amp;quot;)
}
gp.waiting = nil
if gp.param == nil {
	if c.closed == 0 {
		throw(&amp;quot;chansend: spurious wakeup&amp;quot;)
	}
	panic(plainError(&amp;quot;send on closed channel&amp;quot;))
}
gp.param = nil
if mysg.releasetime &amp;gt; 0 {
	blockevent(mysg.releasetime-t0, 2)
}
mysg.c = nil
releaseSudog(mysg)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸»è¦çš„æ£€æŸ¥æœ‰ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯å½“å‰ goroutine çš„é”å®šæ˜¯å¦è¢«ç¯¡æ”¹ï¼šgp.waiting æŒ‡å‘å½“å‰ goroutine è¢«å ç”¨ç­‰å¾…çš„  &lt;code&gt;sudog&lt;/code&gt; ç»“æ„ä½“ã€‚å¦ä¸€ä¸ªæ£€æŸ¥æ˜¯å½“å‰ channel çš„å…³é—­çŠ¶æ€ï¼Œå€˜è‹¥å½“å‰ channel å·²ç»å…³é—­ï¼Œåˆ™ä¼šå¯¼è‡´ç¨‹åºPanicï¼Œå› ä¸ºä»ä¸€ä¸ªå·²ç»å…³é—­çš„ channel ä¸­å†™æ•°æ®æ˜¯ä¸è¢«å…è®¸çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ£€æŸ¥å®Œæ¯•ä¹‹åä¾¿æ˜¯å¯¹èµ„æºçš„å›æ”¶ã€‚è‡³æ­¤ä¸€ä¸ªå®Œæ•´çš„ channel å‘é€æµç¨‹ä¾¿èµ°å®Œäº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;how-to-send&#34;&gt;How to send ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä¸Šæ–‡æåˆ°å¦‚æœæ˜¯ä¸¤ä¸ª gouroutine ç›´æ¥è¿›è¡Œæ•°æ®äº¤æµï¼ˆä¸ç»è¿‡ç¼“å†²é˜Ÿåˆ—ï¼‰ï¼Œç¨‹åºä¼šè°ƒç”¨ &lt;code&gt;send()&lt;/code&gt; è¿›è¡Œæ•°æ®å‘é€ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å‘é€æ•°æ®å‘¢ï¼Ÿ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:269
func send(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf func(), skip int) {
	if raceenabled {	// æ­£å¸¸è¿è¡ŒçŠ¶æ€ä¸‹ï¼Œraceenabled ä¸º falseï¼Œ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ— è§†å§ğŸ¤«
		if c.dataqsiz == 0 {
			racesync(c, sg)
		} else {
			// Pretend we go through the buffer, even though
			// we copy directly. Note that we need to increment
			// the head/tail locations only when raceenabled.
			qp := chanbuf(c, c.recvx)
			raceacquire(qp)
			racerelease(qp)
			raceacquireg(sg.g, qp)
			racereleaseg(sg.g, qp)
			c.recvx++
			if c.recvx == c.dataqsiz {
				c.recvx = 0
			}
			c.sendx = c.recvx // c.sendx = (c.sendx+1) % c.dataqsiz
		}
	}
	if sg.elem != nil {
		sendDirect(c.elemtype, sg, ep) // ç›´æ¥å°†æ•°æ® ep æ‹·è´åˆ°æ¥æ”¶çš„ goroutine ä¸­
		sg.elem = nil
	}
	gp := sg.g
	unlockf()
	gp.param = unsafe.Pointer(sg)	//å°†å½“å‰çš„ sudog è®¾ç½®ä¸ºæ¥æ”¶æ–¹ goroutine å”¤é†’åçš„å‚æ•°
	if sg.releasetime != 0 {
		sg.releasetime = cputicks()
	}
	goready(gp, skip+1)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;raceenabled ç«äº‰æ£€æµ‹ç›¸å…³è¿™é‡Œæˆ‘ä»¬å°±ç•¥è¿‡ä¸å±•å¼€è®²äº†ï¼ˆå…¶å®æ˜¯ä¸ä¼šï¼‰ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼Œä¸è¦å¿˜äº†å­¦æˆå½’æ¥è¯„è®ºåˆ†äº«ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨åˆ†æå‘é€é€»è¾‘ä¹‹å‰æˆ‘ä»¬è¦æ˜ç¡®ä¸¤ä»¶äº‹ï¼šä¸€ä¸ªæ˜¯åœ¨ &lt;code&gt;send()&lt;/code&gt; ä¸­ä¼ å…¥çš„ sg å·²ç»ä¸æ˜¯å‘é€æ–¹çš„  &lt;code&gt;sudog&lt;/code&gt; ç»“æ„ä½“è€Œæ˜¯æ•°æ®æ¥æ”¶é˜Ÿåˆ—ä¸­çš„æ¥æ”¶æ–¹ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯æ­¤æ—¶æ•°æ®æ¥æ”¶æ–¹çš„ goroutine å¿…ç„¶æ˜¯ä¼‘çœ çŠ¶æ€çš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code&gt;send()&lt;/code&gt; ä¸­ç¨‹åºè°ƒç”¨ &lt;code&gt;sendDirect()&lt;/code&gt; å°†æ•°æ® ep çš„å†…å®¹&lt;font color=red&gt;&lt;strong&gt;ç›´æ¥æ‹·è´&lt;/strong&gt;&lt;/font&gt;åˆ°æ¥æ”¶ goroutine çš„å†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åå›æ”¶æŒ‡å‘è¯¥å†…å­˜çš„æŒ‡é’ˆï¼ŒåŒæ—¶ä¹Ÿä¼šå°†å½“å‰çš„ &lt;code&gt;sudog&lt;/code&gt; è®¾ç½®ä¸ºæ¥æ”¶æ–¹ goroutine å”¤é†’åçš„å‚æ•°ã€‚æœ€åé€šè¿‡è°ƒç”¨ &lt;code&gt;goready()&lt;/code&gt; å”¤é†’ä¼‘çœ çš„æ¥æ”¶ goroutine æ¥å®Œæˆæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;channel-æ¥æ”¶&#34;&gt;Channel æ¥æ”¶&lt;/h2&gt;

&lt;p&gt;channel çš„æ¥æ”¶é€»è¾‘åŒæ ·åœ¨ &lt;code&gt;src/runtime/chan.go&lt;/code&gt; ä¸­ï¼Œä¸»è¦ä¹Ÿæ˜¯ &lt;code&gt;chanrecv()&lt;/code&gt; å’Œ &lt;code&gt;recv()&lt;/code&gt; ä¸¤ä¸ªæ¥å£ã€‚æ¥æ”¶é€»è¾‘å¤§ä½“ä¸Šå’Œå‘é€ååˆ†ç±»ä¼¼ï¼Œ&lt;del&gt;ç”šè‡³å¯ä»¥ç†è§£ä¸ºä»…ä»…æ˜¯æ•°æ®æµåŠ¨çš„æ–¹å‘æ”¹å˜äº†è€Œå·²ã€‚&lt;/del&gt;ä¸»è¦çš„å·®å¼‚ä½“ç°åœ¨æ•°æ®çš„äº¤æ¢é€»è¾‘ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ— ç¼“å†²-channel-æ¥æ”¶&#34;&gt;æ— ç¼“å†² channel æ¥æ”¶&lt;/h3&gt;

&lt;h4 id=&#34;ç›´æ¥æ¥æ”¶&#34;&gt;ç›´æ¥æ¥æ”¶&lt;/h4&gt;

&lt;p&gt;æ— ç¼“å†² channel åœ¨è¿›è¡Œæ•°æ®æ¥æ”¶æ—¶ï¼Œå¦‚æœå‘é€é˜Ÿåˆ— sendq å·²ç»æœ‰ç­‰å¾…çš„å‘é€ goroutineï¼Œé‚£ä¹ˆå½“å‰ goroutine ä¼šç›´æ¥å’Œè¿™ä¸ªå‘é€è€…è¿›è¡Œæ•°æ®æ‹·è´ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:473
if sg := c.sendq.dequeue(); sg != nil { 	//å¦‚æœæ•°æ®å‘é€ç­‰å¾…é˜Ÿåˆ—æœ‰æ­£åœ¨ç­‰å¾…çš„ goroutine
	// Found a waiting sender. If buffer is size 0, receive value
	// directly from sender. Otherwise, receive from head of queue
	// and add sender&#39;s value to the tail of the queue (both map to
	// the same buffer slot because the queue is full).
	recv(c, sg, ep, func() { unlock(&amp;amp;c.lock) }, 3) //æ•°æ®æ¥æ”¶å¤„ç†
	return true, true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;æ¥æ”¶é˜»å¡&#34;&gt;æ¥æ”¶é˜»å¡&lt;/h4&gt;

&lt;p&gt;å½“å‘é€é˜Ÿåˆ— sendq ä¸Šæ²¡æœ‰æ­£åœ¨ç­‰å¾…å‘é€æ•°æ®çš„ goroutine æ—¶ï¼Œç”±äºä¸å­˜åœ¨ç¼“å†²é˜Ÿåˆ—ï¼Œå½“å‰ goroutine éœ€è¦åŒ…è£…æˆä¸Šæ–‡æåˆ°çš„ &lt;code&gt;sudog&lt;/code&gt; ç»“æ„ä½“å¹¶æ’å…¥åˆ°æ•°æ®æ¥æ”¶ç­‰å¾…é˜Ÿåˆ— recvq ä¸­ã€‚ä¹‹åä¾¿æ˜¯è°ƒç”¨ &lt;code&gt;goparkunlock()&lt;/code&gt; è®©å½“å‰ goroutine è¿›å…¥æ¼«é•¿çš„ç­‰å¾…äº†ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;// no sender available: block on this channel.
gp := getg()
mysg := acquireSudog()
mysg.releasetime = 0
if t0 != 0 {
	mysg.releasetime = -1
}
// No stack splits between assigning elem and enqueuing mysg
// on gp.waiting where copystack can find it.
mysg.elem = ep
mysg.waitlink = nil
gp.waiting = mysg
mysg.g = gp
mysg.isSelect = false
mysg.c = c
gp.param = nil
c.recvq.enqueue(mysg)
goparkunlock(&amp;amp;c.lock, waitReasonChanReceive, traceEvGoBlockRecv, 3)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å’Œå‘é€ç•¥å¾®ä¸åŒçš„æ˜¯ï¼Œç”±äºæ•°æ®æ¥æ”¶æ“ä½œå¹¶æ²¡æœ‰æ•°æ®éœ€è¦ä¿æŠ¤ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦ç±»ä¼¼ &lt;code&gt;KeepAlive()&lt;/code&gt; è¿™æ ·çš„æ¥å£æ¥å¯¹æ•°æ®è¿›è¡Œå®‰å…¨é”å®šã€‚&lt;/p&gt;

&lt;h3 id=&#34;æœ‰ç¼“å†²-channel-æ¥æ”¶&#34;&gt;æœ‰ç¼“å†² channel æ¥æ”¶&lt;/h3&gt;

&lt;h4 id=&#34;ç›´æ¥æ¥æ”¶-1&#34;&gt;ç›´æ¥æ¥æ”¶&lt;/h4&gt;

&lt;p&gt;å½“ goroutine ä»æŸä¸ªæœ‰ç¼“å†² channel æ¥æ”¶æ•°æ®æ—¶ï¼Œä¾ç„¶ä¼šå¯¹å‘é€é˜Ÿåˆ— sendq è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…å‘é€çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¡¨ç¤ºå½“å‰æœ‰è®¸å¤šæ•°æ®å¯ä»¥æ¥æ”¶ï¼ˆæ»¡å®¹é‡ç¼“å†²é˜Ÿåˆ—+å‘é€ç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œæ¥æ”¶çš„ goroutine ä¼šè°ƒç”¨ &lt;code&gt;recv()&lt;/code&gt; æ¥å£è¿›è¡Œæ•°æ®äº¤æ¥ã€‚ä½†æ˜¯ï¼è¯·ä¸è¦è¯¯ä¼šæ•°æ®æ¥æ”¶çš„å¯¹è±¡æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å‘é€è€…ã€‚channel çš„è°ƒåº¦éµå¾ª FIFO åŸåˆ™ï¼Œä¸ä¼šå› ä¸ºä½ æ˜¯ä¸€ä¸ªæ­£åœ¨ç­‰å¾…çš„ goroutine è€Œä¼˜å…ˆå¤„ç†ã€‚ç„¶è€Œå…·ä½“æ˜¯å¦‚ä½•æ¥æ”¶æ•°æ®ï¼Œåœ¨æ­¤å…ˆä¹°ä¸ªå…³å­ã€‚&lt;/p&gt;

&lt;p&gt;å€˜è‹¥å‘é€é˜Ÿåˆ— sendq ä¸­æ²¡æœ‰ç­‰å¾…çš„å‘é€å¯¹è±¡ï¼Œä¸è¦æ…Œï¼Œæˆ‘ä»¬è¿˜æœ‰ç¼“å†²æ± ã€‚å½“ç¼“å†²é˜Ÿåˆ—å¤§å°ä¸ä¸º0æ—¶ï¼Œè¯´æ˜ä»æœ‰æ•°æ®å¯ä¾›æ¥æ”¶ï¼Œå½“å‰çš„ goroutine ä¼šè°ƒç”¨ &lt;code&gt;typedmemmove()&lt;/code&gt; å°†ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°è‡ªå·±çš„å†…å­˜ä¸­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:482
if c.qcount &amp;gt; 0 {	//åˆ¤æ–­å¾ªç¯é˜Ÿåˆ—ä¸­çš„ç¼“å†²å¯¹è±¡
	// Receive directly from queue
	qp := chanbuf(c, c.recvx)
	if raceenabled {
		raceacquire(qp)
		racerelease(qp)
	}
	if ep != nil {
		typedmemmove(c.elemtype, ep, qp)	//ç›´æ¥å°†ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å½“å‰ goroutine ä¸­
	}
	typedmemclr(c.elemtype, qp)	//æ¸…é™¤ç¼“å†²åŒºä¸­çš„æ•°æ®
	c.recvx++
	if c.recvx == c.dataqsiz {	//å¾ªç¯é˜Ÿåˆ—å¸¸è§„æ“ä½œ
		c.recvx = 0
	}
	c.qcount--
	unlock(&amp;amp;c.lock)
	return true, true
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;æ¥æ”¶é˜»å¡-1&#34;&gt;æ¥æ”¶é˜»å¡&lt;/h4&gt;

&lt;p&gt;å½“ç¼“å†²é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰å¯æ¥æ”¶æ•°æ®æ—¶ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªæœ‰ç¼“å†²çš„ channelï¼Œgoroutine ä¹Ÿè¦ä¹–ä¹–è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¿™é‡Œçš„é€»è¾‘å’Œä¸Šæ–‡ä¸­æ— ç¼“å†² channel æ¥æ”¶é˜»å¡é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥è‡ªè¡Œå›é¡¾&lt;a href=&#34;#æ¥æ”¶é˜»å¡&#34;&gt;æ— ç¼“å†² channel æ¥æ”¶æ•°æ®é˜»å¡è¿‡ç¨‹&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å”¤é†’-1&#34;&gt;å”¤é†’&lt;/h3&gt;

&lt;p&gt;é˜»å¡çŠ¶æ€çš„æ¥æ”¶ goroutine åœ¨æ¼«é•¿çš„ç­‰å¾…ä¹‹åè¢«å”¤é†’ï¼Œè¿™ä¸ªæ—¶å€™å®ƒä¼šå‘ç°æ•°æ®å·²ç»æ‹·è´åˆ°è‡ªå·±çš„å†…å­˜ä¸­ï¼ˆç±»ä¼¼äºç¡äº†ä¸€å¤©ç„¶åé†’æ¥å‘ç°ä¸€å¤©çš„å·¥èµ„å·²ç»å‘åˆ°é“¶è¡Œå¡é‡Œé‚£ç§æ„Ÿè§‰ï¼‰ï¼Œéœ€è¦è‡ªå·±åšçš„ä»…ä»…æ˜¯æ•°æ®çš„æ•´ç†æ£€æŸ¥ç­‰æ”¶å°¾å·¥ä½œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:526
// someone woke us up
if mysg != gp.waiting {
	throw(&amp;quot;G waiting list is corrupted&amp;quot;)
}
gp.waiting = nil
if mysg.releasetime &amp;gt; 0 {
	blockevent(mysg.releasetime-t0, 2)
}
closed := gp.param == nil
gp.param = nil
mysg.c = nil
releaseSudog(mysg)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œçš„æ£€æŸ¥ç›¸è¾ƒäºå‘é€çš„å”¤é†’æ“ä½œå°‘äº†ä¸€ä¸ª channel çš„å…³é—­çŠ¶æ€æ£€æŸ¥ã€‚å› ä¸ºåœ¨è®¾è®¡ä¸Šï¼Œå³ä½¿ channel å·²ç»è¢«å…³é—­ï¼Œåªè¦è¿˜æœ‰æ•°æ®æ®‹ç•™ï¼Œchannel ä¾ç„¶æ˜¯å¯è¯»çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;how-to-receive&#34;&gt;How to receive ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œchannel ä¸­æ¥æ”¶å’Œå‘é€çš„é€»è¾‘è¿˜æ˜¯ååˆ†ç›¸ä¼¼çš„ï¼ŒçœŸæ­£çš„åŒºåˆ«åœ¨äº &lt;code&gt;send()&lt;/code&gt; å’Œ &lt;code&gt;recv()&lt;/code&gt; çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯å®é™…çš„æ•°æ®ä¼ è¾“æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code&gt;recv()&lt;/code&gt; å‡½æ•°ä¸­ï¼Œç¨‹åºåªçŸ¥é“æœ‰æ•°æ®éœ€è¦æ¥æ”¶ï¼Œä½†ä¸ç¡®å®šæ•°æ®æºæ˜¯ä» &lt;code&gt;sudog&lt;/code&gt; å¯¹è±¡ä¸­è¿˜æ˜¯ä»ç¼“å†²é˜Ÿåˆ—ä¸­è·å–ï¼Œæ‰€ä»¥åœ¨æ¥æ”¶æ•°æ®å‰è¿˜éœ€è¦æ ¹æ® channel çš„çŠ¶æ€è¿›è¡Œåˆ¤æ–­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Go&#34;&gt;# go1.13:src/runtime/chan.go:554
func recv(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf func(), skip int) {
	if c.dataqsiz == 0 {	//æ— ç¼“å†² channel å¤„ç†å…¥å£
		if raceenabled {
			racesync(c, sg)
		}
		if ep != nil {
			// copy data from sender
			recvDirect(c.elemtype, sg, ep)	//ç›´æ¥ä»å‘é€çš„ goroutine ä¸­æ‹·è´æ•°æ®
		}
	} else {	// çœ‹æ³¨é‡Šâ†“â†“â†“â†“â†“â†“
		// Queue is full. Take the item at the
		// head of the queue. Make the sender enqueue
		// its item at the tail of the queue. Since the
		// queue is full, those are both the same slot.
		qp := chanbuf(c, c.recvx)
		if raceenabled {	// ä¸ç”¨ç®¡ç³»åˆ—
			raceacquire(qp)
			racerelease(qp)
			raceacquireg(sg.g, qp)
			racereleaseg(sg.g, qp)
		}
		// copy data from queue to receiver
		if ep != nil {
			typedmemmove(c.elemtype, ep, qp)	//å°†ç¼“å†²é˜Ÿåˆ—é˜Ÿé¦–çš„æ•°æ®æ‹·è´åˆ°å½“å‰æ¥æ”¶æ•°æ®çš„ goroutine ä¸­
		}
		// copy data from sender to queue
		typedmemmove(c.elemtype, qp, sg.elem)	//å°†é˜»å¡çš„å‘é€ goroutine ä¸­çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²é˜Ÿåˆ—ä¸­
		c.recvx++
		if c.recvx == c.dataqsiz {
			c.recvx = 0
		}
		c.sendx = c.recvx // c.sendx = (c.sendx+1) % c.dataqsiz
	}
	sg.elem = nil
	gp := sg.g
	unlockf()
	gp.param = unsafe.Pointer(sg)
	if sg.releasetime != 0 {
		sg.releasetime = cputicks()
	}
	goready(gp, skip+1)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨è¿™é‡Œï¼Œä¼ å…¥çš„ sg æ˜¯å‘é€æ•°æ®æ–¹çš„ä¸€ä¸ªå·²ç»è¿›å…¥ä¼‘çœ çš„ &lt;code&gt;sudog&lt;/code&gt; ç»“æ„ä½“ã€‚ é¦–å…ˆæ£€æŸ¥ç¼“å†²é˜Ÿåˆ—å¤§å°ï¼Œå¦‚æœå¤§å°ä¸º0ï¼ˆæ— ç¼“å†² channel ï¼‰ï¼Œè°ƒç”¨ &lt;code&gt;recvDirect()&lt;/code&gt; å¯¹æ•°æ®è¿›è¡Œ&lt;font color=red&gt;&lt;strong&gt;ç›´æ¥æ‹·è´&lt;/strong&gt;&lt;/font&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ˜¯æœ‰ç¼“å†²é˜Ÿåˆ—çš„ channelï¼Œé‚£ä¹ˆè¡¨ç¤ºç¼“å†²é˜Ÿåˆ—å·²ç»æ»¡å‘˜ï¼ˆå› ä¸ºå‘é€é˜Ÿåˆ—å·²ç»æœ‰ goroutine é˜»å¡ï¼‰ï¼Œæ¥ä¸‹æ¥éœ€è¦å®Œæˆä¸¤ä»¶äº‹ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å°†ç¼“å†²é˜Ÿåˆ—é˜Ÿé¦–çš„æ•°æ®æ‹·è´åˆ°å½“å‰æ¥æ”¶æ•°æ®çš„ goroutine ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å°†é˜»å¡çš„å‘é€ goroutine ä¸­çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²é˜Ÿåˆ—é˜Ÿå°¾ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å®Œæˆäº†æ•°æ®äº¤æ¥åï¼Œè°ƒç”¨ &lt;code&gt;goready()&lt;/code&gt; è½»è½»å”¤é†’é˜»å¡çš„æ•°æ®å‘é€ goroutineï¼Œæ·±è—åŠŸä¸åã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;è®¸å¤šæ–‡ç« å°† channel ç±»æ¯”ä¸ºâ€œç®¡é“â€ä¹‹ç±»çš„å·¥å…·ï¼Œä½†åœ¨äº†è§£ channel çš„å®Œæ•´è°ƒåº¦é€»è¾‘åï¼Œæˆ‘æ›´å¸Œæœ›å°†å…¶æ¯”ä½œä¸€ä¸ªé«˜é€Ÿå…¬è·¯ä¸­çš„è´§ç‰©ä¸­è½¬ç«™ã€‚æ¥æ¥å¾€å¾€çš„è´§è½¦å¸æœºï¼ˆgoroutineï¼‰åœ¨æ­¤è£…è´§å¸è´§ï¼Œæœ‰æ— ä»“åº“ï¼ˆç¼“å†²ï¼‰å†³å®šäº†è´§è½¦å¸æœºéœ€ä¸éœ€è¦åœ¨ä¸­è½¬ç«™é€—ç•™ç­‰å¾…ï¼Œè¿Ÿåˆ°çš„è´§è½¦å¸æœºè´Ÿè´£è´§ç‰©çš„è£…è½½æˆ–æ‹†å¸ï¼ˆæ•°æ®ä¼ è¾“ï¼‰å¹¶é€šçŸ¥å¯¹åº”çš„å¸æœºå®Œæˆè´§ç‰©äº¤æ¥ã€‚&lt;/li&gt;
&lt;li&gt;Go åŸºäº CSP æ¨¡å‹ä¸­çš„ process å’Œ channel çš„æ¦‚å¿µè®¾è®¡äº†åŸºäº channel çš„å¹¶å‘æ¨¡å‹å¹¶æå€¡â€œé€šè¿‡é€šä¿¡å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡â€ã€‚ç„¶è€Œè¿™æ›´å¤šæ˜¯ä¸€ç§è¡Œä¸ºä¸Šçš„æ¦‚å¿µï¼Œå®é™…å®ç°ä¸­è¿˜æ˜¯æ— æ³•é¿å…åœ°å…±äº«äº† hchan ç”šè‡³ç¼“å†² buf ç­‰æ•°æ®ç»“æ„ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯å½“ä¸¤ä¸ª goroutine ç›´æ¥äº¤æ¢æ•°æ®æ—¶ï¼Œä»–ä»¬æ˜¯å¯ä»¥ç›´æ¥æ“ä½œå¯¹æ–¹çš„å†…å­˜ç©ºé—´ï¼ˆé€šè¿‡ &lt;code&gt;sendDirect()&lt;/code&gt; å’Œ &lt;code&gt;recvDirect()&lt;/code&gt; ä¸¤ä¸ªæ–¹æ³•ï¼‰ï¼Œé¿å…äº†æ•°æ®çš„å¤šæ¬¡æ‹·è´å’Œé¢å¤–çš„é”æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†éµå¾ª FIFO åŸåˆ™ï¼ŒGo è¯­è¨€ç”¨ä¸¤ä¸ªæŒ‡é’ˆåŠ æ•°ç»„å®ç°äº†å¾ªç¯é˜Ÿåˆ—ï¼Œå®é™…ä¸Šè¿™å¤§æ¦‚ä¹Ÿæ˜¯é˜Ÿåˆ—çš„æœ€ä½³å®ç°æ–¹å¼äº† &amp;hellip; &amp;hellip; å§ï¼Ÿ&lt;/li&gt;
&lt;li&gt;channel ä½¿ç”¨ mutex æ¥ä¿éšœå®ƒæ˜¯ goroutine å®‰å…¨çš„ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è§£é”æ“ä½œå¹¶ä¸ä¸€å®šæ˜¯åœ¨å½“å‰åŠ é”çš„å¤„ç†å‡½æ•°ä¸­ã€‚å®ƒé€šè¿‡ä¼ é€’è§£é”æ¥å£ &lt;code&gt;unlockf()&lt;/code&gt; æ¥ç¡®ä¿å¯¹æ•°æ®ä¿®æ”¹ç»“æŸåç¬¬ä¸€æ—¶é—´è¿›è¡Œé”çš„é‡Šæ”¾ï¼Œä»è€Œå®ç°é”çš„è¦†ç›–æ—¶é—´æ˜¯æœ€çŸ­çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://speakerdeck.com/kavya719/understanding-channels&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;diving-deep-into-the-golang-channels&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MySQL å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
      <link>https://aka-bingo.github.io/2019/05/mysql-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/</link>
      <pubDate>Sat, 25 May 2019 15:47:10 +0800</pubDate>
      
      <guid>https://aka-bingo.github.io/2019/05/mysql-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/</guid>
      <description>

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-mvcc&#34;&gt;ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ MVCC ï¼‰&lt;/h2&gt;

&lt;p&gt;MySQL çš„å¤§å¤šæ•°äº‹åŠ¡å‹å­˜å‚¨å¼•æ“åŸºäºæå‡å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œä¸€èˆ¬éƒ½å®ç°äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ MVCC ï¼‰ã€‚MVCC æ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†å®é™…ä¸Šå®ç°æœºåˆ¶æœ‰æ‰€ä¸åŒï¼Œé¿å…äº†åŠ é”çš„æ“ä½œï¼Œå› æ­¤æœ‰äº†æ›´ä½çš„å¼€é”€å’Œæ›´é«˜çš„æ€§èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;MVCC çš„å®ç°ï¼Œæ˜¯é€šè¿‡ä¿æŒæ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°çš„ï¼Œä¸ç®¡äº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´æœ‰å¤šä¹…ï¼ŒMVCC ä¿éšœäº†æ¯ä¸€ä¸ªäº‹åŠ¡å†…çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œè€Œæ ¹æ®äº‹åŠ¡å¼€å§‹æ—¶é—´ï¼Œä¸åŒäº‹åŠ¡çœ‹åˆ°åŒä¸€å¼ è¡¨ï¼ŒåŒä¸€ä»½æ•°æ®å¯èƒ½æ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;

&lt;p&gt;ä¸åŒå­˜å‚¨å¼•æ“å¯¹ MVCC çš„å®ç°æœºåˆ¶ä¸å°½ç›¸åŒï¼Œå› ä¸º MVCC å¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¸‹é¢ä»¥ InnoDB ä¸ºä¾‹ï¼Œç®€è¦ä»‹ç» MVCC çš„å®ç°åŸç†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;innodb-ä¸­çš„-mvcc&#34;&gt;InnoDB ä¸­çš„ MVCC&lt;/h2&gt;

&lt;p&gt;InnoDB ä¸­çš„ MVCCï¼Œæ˜¯é€šè¿‡åœ¨æ¯è¡Œè®°å½•åä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—æ¥å®ç°çš„ã€‚è¿™ä¸¤ä¸ªç‰¹æ®Šçš„åˆ—ä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ é™¤æ—¶é—´ã€‚å½“ç„¶è¿™é‡Œå­˜å‚¨çš„å¹¶ä¸æ˜¯çœŸå®çš„æ—¶é—´ï¼Œå®é™…ä¸Šå­˜å‚¨çš„æ˜¯&lt;strong&gt;ç‰ˆæœ¬å·&lt;/strong&gt;ï¼ˆ system version number ï¼‰ã€‚æ¯æ¬¡å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·ä¼šå¼€å§‹é€’å¢å¹¶åˆ†é…ç»™å½“å‰çš„äº‹åŠ¡ï¼Œç”¨äºä¸æ•°æ®çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚ç®€è¦ä»‹ç»ä¸‹ InnoDB æ˜¯å¦‚ä½•æ“ä½œçš„ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;SELECTï¼šåœ¨ InnoDB ä¸­ï¼ŒSELECT æ“ä½œæœ‰ä¸¤ä¸ªé¢å¤–çš„æ¡ä»¶ï¼š

&lt;ol&gt;
&lt;li&gt;åªæŸ¥æ‰¾è¡Œçš„åˆ›å»ºç‰ˆæœ¬å·å°äºæˆ–ç­‰äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·çš„æ•°æ®ã€‚è¿™æ ·å¯ä»¥ä¿è¯äº‹åŠ¡è¯»å–çš„æ•°æ®è¦ä¹ˆæ˜¯åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡æœ¬èº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ã€‚&lt;/li&gt;
&lt;li&gt;è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è¦ä¹ˆæœªå®šä¹‰ï¼Œè¦ä¹ˆå¤§äºå½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ã€‚è¿™æ ·æ˜¯ä¸ºäº†ç¡®ä¿äº‹åŠ¡è¯»å–çš„æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰æœªè¢«åˆ é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;INSERTï¼šInnoDB ä¸ºæ¯è¡Œæ–°å¢æ•°æ®è®¾ç½®äº†å½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ä½œä¸ºåˆ›å»ºç‰ˆæœ¬å·ï¼Œåˆ é™¤ç‰ˆæœ¬å·ç•™ç©ºã€‚&lt;/li&gt;
&lt;li&gt;DELETEï¼šInnoDB ä¸ºæ¯è¡Œåˆ é™¤çš„æ•°æ®è®¾ç½®äº†å½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ä½œä¸ºåˆ é™¤ç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;UPDATEï¼šInnoDB é¢å¤–æ’å…¥ä¸€æ¡æ–°çš„è®°å½•ï¼Œå°†å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä½œä¸ºæ–°è®°å½•çš„åˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·åˆ°åŸæ¥çš„æ•°æ®ä¸­çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ InnoDB ä¸­ï¼ŒMVCC åªåœ¨ READ COMMITTED å’Œ REPEATABLE READ è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚å…¶ä»–çš„éš”ç¦»çº§åˆ«å’Œ MVCC å¹¶ä¸å…¼å®¹ï¼ŒREAD UNCOMMITTED æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®ï¼Œè€Œ SERIALIZABLE åˆ™ä¼šå¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½è¿›è¡ŒåŠ é”æ“ä½œã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;MVCC è§£å†³äº†å¤šä¸ªäº‹åŠ¡å¹¶å‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¹»è¯»é—®é¢˜ã€‚é€šè¿‡ä¿å­˜é¢å¤–çš„ä¸¤ä¸ªç³»ç»Ÿç‰ˆæœ¬å·å­—æ®µï¼Œä½¿å¾—å¤§éƒ¨åˆ†è¯»æ“ä½œå¯ä»¥ä¸ç”¨åŠ é”ï¼Œæé«˜äº†è¯»å–æ€§èƒ½çš„åŒæ—¶ä¹Ÿä¿éšœäº†è¯»å–èŒƒå›´çš„å¯é æ€§ã€‚å”¯ä¸€çš„ä¸è¶³æ˜¯æ¯è¡Œæ•°æ®éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œä»¥åŠéœ€è¦æ›´å¤šçš„è¡Œæ£€æŸ¥å’Œç»´æŠ¤å·¥ä½œï¼Œä½†æ˜¯åœ¨æ•°æ®è¯»å–ä¿éšœå’Œæ€§èƒ½æ–¹é¢çš„å·¨å¤§æå‡å‰æä¸‹ï¼Œè¿™äº›ä¸è¶³ä¾¿æ˜¾å¾—ååˆ†å®¹æ˜“æ¥å—äº†ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
      <link>https://aka-bingo.github.io/2019/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</link>
      <pubDate>Wed, 22 May 2019 21:48:03 +0800</pubDate>
      
      <guid>https://aka-bingo.github.io/2019/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</guid>
      <description>

&lt;h2 id=&#34;å®šä¹‰&#34;&gt;å®šä¹‰&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;è„è¯»ï¼ˆ Dirty Read ï¼‰ï¼šå½“äº‹åŠ¡ A å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹åï¼Œäº‹åŠ¡ B è¯»å–äº†è¢«æ”¹åŠ¨åçš„æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡ A è¿›è¡Œäº†å¼‚å¸¸å›æ»šï¼Œäº‹åŠ¡Bè¯»å–åˆ°çš„æ˜¯æœªç»æäº¤çš„æ•°æ®ï¼Œç§°ä¹‹ä¸ºè„è¯»ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å¯é‡å¤è¯»ï¼ˆ NonRepeatable Read ï¼‰ï¼šäº‹åŠ¡ A ä¸­è¯»å–äº†æ•°æ®åï¼Œäº‹åŠ¡ B å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œäº‹åŠ¡ A å†æ¬¡å¯¹æ•°æ®è¿›è¡Œè¯»å–å‘ç°å‰åä¸ä¸€è‡´ï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚&lt;/li&gt;
&lt;li&gt;å¹»è¯»ï¼ˆ Phantom Read ï¼‰ï¼šäº‹åŠ¡ A åœ¨è¯»å–æŸä¸ªèŒƒå›´å†…çš„è®°å½•æ—¶ï¼Œäº‹åŠ¡ B åœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°çš„è®°å½•ï¼Œäº‹åŠ¡ A å†æ¬¡è¿›è¡Œæ•°æ®ç»Ÿè®¡åå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œç§°ä¹‹ä¸ºå¹»è¯»ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PSï¼šä¸å¯é‡å¤è¯»å’Œå¹»è¯»ä»ç»“æœä¸Šçœ‹ååˆ†ç›¸ä¼¼ï¼Œéƒ½æ˜¯æ•°æ®åœ¨ä¸¤æ¬¡è¯»å–é—´éš”é—´è¿›è¡Œä¿®æ”¹å¯¼è‡´ä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ä¸å¯é‡å¤è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡å†…å¯¹åŒä¸€æ•°æ®çš„å¤šæ¬¡è¯»å–çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;å¹»è¯»æŒ‡çš„æ˜¯äº‹åŠ¡çš„è¯»å–èŒƒå›´è¢«å…¶ä»–äº‹åŠ¡æ”¹å˜çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;éš”ç¦»çº§åˆ«&#34;&gt;éš”ç¦»çº§åˆ«&lt;/h2&gt;

&lt;p&gt;åœ¨ SQL æ ‡å‡†ä¸­å®šä¹‰äº†å››ç§éš”ç¦»çº§åˆ«ï¼Œæ¯ä¸€ç§çº§åˆ«éƒ½è§„å®šäº†ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€åšçš„ä¿®æ”¹ï¼Œå“ªäº›åœ¨äº‹åŠ¡å†…å’Œäº‹åŠ¡é—´æ˜¯å¯è§æˆ–ä¸å¯è§çš„ã€‚è¾ƒä½çº§çš„éš”ç¦»çº§åˆ«ä¸€èˆ¬ç³»ç»Ÿçš„å¼€é”€ä¹Ÿæ›´ä½ï¼Œå¯ä»¥æ”¯æ’‘æ›´é«˜çš„å¹¶å‘ï¼Œä½†æ˜¯å¯¹ä¸Šå±‚åº”ç”¨çš„æ•°æ®è¯»å–å¯èƒ½ä¼šé€ æˆå½±å“ã€‚&lt;/p&gt;

&lt;h3 id=&#34;read-uncommitted-æœªæäº¤è¯»&#34;&gt;READ UNCOMMITTED æœªæäº¤è¯»&lt;/h3&gt;

&lt;p&gt;åœ¨ READ UNCOMMITTED éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡å¯ä»¥å¯¹å…¶ä»–äº‹åŠ¡ä¸­å°šæœªæäº¤çš„æ•°æ®ä¿®æ”¹è¿›è¡Œè¯»å–ã€‚è¿™ä¸ªçº§åˆ«ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚è„è¯»ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&#34;read-committed-æäº¤è¯»&#34;&gt;READ COMMITTED æäº¤è¯»&lt;/h3&gt;

&lt;p&gt;åœ¨ READ COMMITTED éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹ç›´åˆ°æäº¤ä¹‹å‰ï¼Œæ‰€åšçš„ä»»ä½•ä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è¯¥éš”ç¦»çº§åˆ«é¿å…äº†è„è¯»çš„å‘ç”Ÿï¼Œä½†æ˜¯ä¸€ä¸ªäº‹åŠ¡å†…çš„æŸ¥è¯¢ï¼Œä¾ç„¶æœ‰å¯èƒ½è·å¾—ä¸åŒçš„ç»“æœï¼ˆæ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼‰ï¼Œå¯¼è‡´äº§ç”Ÿä¸å¯é‡å¤è¯»ã€‚&lt;/p&gt;

&lt;h3 id=&#34;repeatable-read-å¯é‡å¤è¯»&#34;&gt;REPEATABLE READ å¯é‡å¤è¯»&lt;/h3&gt;

&lt;p&gt;REPEATABLE READ è§£å†³äº†è„è¯»&amp;amp;å¹»è¯»çš„é—®é¢˜ï¼Œè¯¥éš”ç¦»çº§åˆ«ä¿è¯äº†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·çš„è®°å½•ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯è¯¥éš”ç¦»çº§åˆ«ä¾ç„¶ä¼šå¯¼è‡´å¹»è¯»çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;PSï¼šåœ¨ SQL æ ‡å‡†ä¸­ï¼ŒREPEATABLE READ æ— æ³•è§£å†³å¹»è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯ MySQL ä¸­ InnoDB å’Œ XtraDB å­˜å‚¨å¼•æ“é€šè¿‡&lt;a href=&#34;../mysql å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶/&#34;&gt;å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ MVCCï¼ŒMultiVersion Concurrency Control ï¼‰&lt;/a&gt;è§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;serializable-å¯ä¸²è¡ŒåŒ–&#34;&gt;SERIALIZABLE å¯ä¸²è¡ŒåŒ–&lt;/h3&gt;

&lt;p&gt;SERIALIZABLE æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…äº†æ•°æ®çš„è¯»å–é—®é¢˜ã€‚è¯¥éš”ç¦»çº§åˆ«å¯¹è¯»å–çš„æ¯ä¸€è¡Œæ•°æ®éƒ½è¿›è¡ŒåŠ é”ï¼Œå¯èƒ½ä¼šå› ä¸ºå¤§é‡çš„è¶…æ—¶å’Œé”è°ƒåº¦çš„é—®é¢˜å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;éš”ç¦»çº§åˆ«&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;è„è¯»&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;ä¸å¯é‡å¤è¯»&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;å¹»è¯»&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;åŠ é”è¯»&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;READ UNCOMMITTED&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;READ COMMITTED&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;REPEATABLE READ&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;SERIALIZABLE&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;X&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;âˆš&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;READ UNCOMMITTEDï¼šä»æ€§èƒ½ä¸Šæ¥è®²ï¼Œæœªæäº¤è¯»ä¸ä¼šæ¯”å…¶ä»–éš”ç¦»çº§åˆ«å¥½å¤ªå¤šï¼Œä½†æ˜¯å¸¦æ¥çš„é—®é¢˜å’Œé£é™©è¿œè¿œé«˜äºå…¶ä»–éš”ç¦»çº§åˆ«ã€‚é™¤éçœŸçš„æœ‰è¶³å¤Ÿå¿…è¦çš„ä½¿ç”¨ç†ç”±ï¼Œå¦åˆ™è¿œç¦»ä»–ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;READ COMMITTEDï¼šå¤§å¤šæ•°æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«éƒ½æ˜¯æäº¤è¯»ï¼Œå¦‚ SQL Serverï¼ŒOracleã€‚è§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯æ— æ³•é¿å…æ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¿‡ç¨‹å‰åè¯»å–ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;REPEATABLE READï¼šåœ¨ MySQL ä¸­ï¼Œå¯é‡å¤è¯»æ˜¯é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¿éšœäº†ä¸€ä¸ªäº‹åŠ¡åœ¨å¤šæ¬¡è¯»å–æ•°æ®è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–æ•°æ®æ— æ³•æ“ä½œè¯¥æ•°æ®ã€‚ä½†æ˜¯ä¾ç„¶é¿å…ä¸äº†æ–°æ•°æ®çš„æ’å…¥ï¼Œäº§ç”Ÿå¹»è¯»ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;SERIALIZABLEï¼šå®Œå…¨ä¸²è¡ŒåŒ–åœ°æ‰§è¡Œäº‹åŠ¡ï¼Œæ¯æ¬¡è¯»éƒ½éœ€è¦è·å¾—è¡¨çº§å…±äº«é”ï¼Œæœ€å®‰å…¨ï¼Œä¹Ÿæ˜¯æ€§èƒ½æœ€å·®çš„éš”ç¦»çº§åˆ«ã€‚åªæœ‰åœ¨éå¸¸x3éœ€è¦ç¡®ä¿æ•°æ®ä¸€è‡´æ€§è€Œä¸”å¯ä»¥æ¥å—æ— æ³•å¹¶å‘çš„æƒ…å†µï¼Œæ‰èƒ½è€ƒè™‘ä½¿ç”¨ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>About</title>
      <link>https://aka-bingo.github.io/about/</link>
      <pubDate>Sun, 24 Feb 2019 22:54:39 +0800</pubDate>
      
      <guid>https://aka-bingo.github.io/about/</guid>
      <description>

&lt;h3 id=&#34;gopher-phper-æ‹–å»¶ç—‡æ™šæœŸæ‚£è€…&#34;&gt;Gopher, PHPerï¼Œæ‹–å»¶ç—‡æ™šæœŸæ‚£è€…&lt;/h3&gt;

&lt;h3 id=&#34;study-in-æ·±åœ³å¤§å­¦&#34;&gt;Study in æ·±åœ³å¤§å­¦&lt;/h3&gt;

&lt;h3 id=&#34;work-in-kingdee-ä¼ä¸šäº‘ç›˜&#34;&gt;Work in Kingdee-ä¼ä¸šäº‘ç›˜&lt;/h3&gt;

&lt;h3 id=&#34;æˆ‘ä¼šè¿™é‡Œè®°å½•-æ—¥å¸¸è§é—»-æ‰€å­¦æ‰€æƒ³-ç«‹å„ç§å„æ ·çš„flag&#34;&gt;æˆ‘ä¼šè¿™é‡Œè®°å½• æ—¥å¸¸è§é—» &amp;amp; æ‰€å­¦æ‰€æƒ³ &amp;amp; ç«‹å„ç§å„æ ·çš„Flag&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>ä½ å¥½å‘€ï¼Œ2018</title>
      <link>https://aka-bingo.github.io/2018/02/%E4%BD%A0%E5%A5%BD%E5%91%802018/</link>
      <pubDate>Thu, 22 Feb 2018 22:34:47 +0800</pubDate>
      
      <guid>https://aka-bingo.github.io/2018/02/%E4%BD%A0%E5%A5%BD%E5%91%802018/</guid>
      <description>&lt;p&gt;è¿‡å»ä¸€å¹´åŸºæœ¬éƒ½æ‡’å¾—æ²¡æ€ä¹ˆæ›´æ–°ï¼Œæ–°çš„ä¸€å¹´è¦åšå‡ºæ”¹å˜äº†ï¼Œä¸€äº›æ¯”è¾ƒå¥½çš„äº‹æƒ…éœ€è¦å…»æˆä¹ æƒ¯ï¼Œæ¯”å¦‚è·‘æ­¥ã€çœ‹ä¹¦ï¼Œè®°å½•ç”Ÿæ´»çš„ç‚¹æ»´å§ã€‚&lt;/p&gt;

&lt;p&gt;è¯´èµ·è·‘æ­¥ä¸»è¦æ˜¯å› ä¸ºå»å¹´é•¿æ—¶é—´å¯¹ç€ç”µè„‘å·¥ä½œï¼Œå‘¨æœ«åˆæ‡’ï¼Œä½“å‹éšéšæœ‰å‘ç¦çš„è¿¹è±¡ï¼Œ&lt;del&gt;å…¶å®å·²ç»åœ¨å‘ç¦äº†&lt;/del&gt;ã€‚æ–°çš„ä¸€å¹´å’ŒåŒäº‹çº¦å¥½æ¯å‘¨éƒ½å»è·‘æ­¥ï¼Œå¸Œæœ›èƒ½åšæŒä¸‹æ¥å…»æˆä¸€ä¸ªå¥½ä¹ æƒ¯å§ã€‚æ¯•ç«Ÿå¯¹èº«ä½“ä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€ä»¶äº‹æ˜¯çœ‹ä¹¦ã€‚å»å¹´ä¹°äº†ä¸€äº›æ‚ä¹¦ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸“ä¸šçš„ä¹¦å•¦ï¼Œä¸è¿‡åŸºæœ¬æ²¡æ€ä¹ˆçœ‹ï¼Œç›®å‰çœ‹å®Œçš„åªæœ‰ã€Šå®‡å®™ç®€å²ã€‹ã€‚æ–°çš„ä¸€å¹´æ¯å¤©éƒ½è¦æŠ½ä¸ªè‡³å°‘åŠä¸ªå°æ—¶æ¥çœ‹ä¹¦å§ã€‚å‘¨æœ«å¯ä»¥å¤šç‚¹æ—¶é—´ã€‚å¹³æ—¶å¾ˆå¤šæ—¶é—´æµªè´¹åœ¨æ¼«æ— ç›®çš„åœ°ä¸Šç½‘é€›è§†é¢‘ï¼Œç¡®å®æœ‰ç‚¹æµªè´¹äº†ğŸ˜­&lt;/p&gt;

&lt;p&gt;è¿‡å»ä¸€å¹´è¿›æ­¥å…¶å®ä¸å¤§ï¼Œæ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ æ›²çº¿å’Œç›®æ ‡ï¼Œè‡ªåˆ¶åŠ›ä¹Ÿä¸è¶³ã€‚æ–°çš„ä¸€å¹´ä¸»è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹ Golang ä»¥åŠä¸»æµæ¡†æ¶å§ï¼ŒåæœŸå°½é‡èƒ½å¤Ÿç”¨ Go åšå‡ºä¸€äº›ä¸œè¥¿ï¼Œå¤–åŒ…ä¹Ÿå¥½è‡ªå·±çš„è„‘æ´ä¹Ÿç½¢ã€‚å¦å¤–éœ€è¦æŠŠå­¦åˆ°çš„å†™ä¸‹æ¥å·©å›ºè®°å¿†ï¼Œä¸è¦ç­‰ç”¨åˆ°çš„æ—¶å€™åˆå¿˜è®°äº†ã€‚å°½é‡æ·±å…¥åœ°äº†è§£å„ç§äº‹ç‰©è€Œä¸æ˜¯æµ®äºè¡¨é¢ï¼Œä¸ç„¶è®°å¿†ä¸‹æ¥çš„ä¸œè¥¿ä¹Ÿæ˜¯ååˆ†æœ‰é™ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœè¿˜æœ‰å¤šä½™çš„æ—¶é—´çš„è¯ï¼Œå¸Œæœ›èƒ½å½“ä¸ªå¤©æ–‡å­¦å°è¿·å¼Ÿå“ˆå“ˆå“ˆå“ˆå“ˆã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸€æ¬¡è¿‡å¹´è¿‡å¾—æ˜¯çœŸçš„å¾ˆçº ç»“ï¼Œå·®ç‚¹åšäº†ä¸€äº›å½±å“è‡ªå·±ä¸€ç”Ÿçš„å†³å®šã€‚ä¸çŸ¥é“æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹è¿˜æ˜¯åçš„ï¼Œä½†æ˜¯å¸Œæœ›ä»¥ååšçš„å†³å®šéƒ½èƒ½å¤Ÿå……è¶³åœ°æ€è€ƒä»¥åŠè®©è‡ªå·±ä¸åæ‚”å§ã€‚æ¥åˆ°æ·±åœ³ç¬¬äº”å¹´äº†ï¼Œéšéšæœ‰äº†é€ƒç¦»çš„å¿µå¤´ï¼Œç°åœ¨ä¹Ÿè¦å¼€å§‹å¯¹ä»¥åçš„èµ°å‘è®¤è®¤çœŸçœŸåœ°è§„åˆ’è€Œä¸æ˜¯ç©ºæƒ³äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šæ˜¯2018å¹´çš„ Flagï¼Œè™½ç„¶å…¨éƒ½æ˜¯å¸Œæœ›ï¼Œ2019å¹´æ¥éªŒè¯ä¸€ä¸‹æ˜¯å¦å˜æˆç°å®å§ï¼&lt;/p&gt;

&lt;p&gt;â€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯æ— æ„ä¸­åœ¨ä»¥å‰çš„åšå®¢ï¼ˆ Git Page ï¼‰çœ‹åˆ°çš„ã€‚å›å¤´çœ‹çœ‹å…¶å®å¾ˆå¤šäº‹é“ç†éƒ½æ‡‚ä½†æ˜¯æ„å¿—åŠ›ä¸å¤Ÿåšå¼ºæ²¡æ³•è´¯å½»ï¼Œè¿ç§»åˆ°ç›®å‰çš„ Blog ä¸­åŠè®½åˆºåŠé­ç­–ä¸€ä¸‹è‡ªå·±å§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
  </channel>
</rss>